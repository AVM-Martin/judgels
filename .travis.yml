language: java

git:
  depth: false

addons:
  ssh_known_hosts: test3.ia-toki.org

env:
  global:
    - secure: Diw2z2elX9jgv1SaTJVrCY7I/X4t55e7v6+20TqB4NtcsJdlB4x3Eg4jnWEC/GKo0VGDNG70rmNHxXwQcZ7UJp2Rle/cMD+BX1QcxxjDWTz7kLPFdMp7ijQR8CHKCoN/asc/oSyhmRrgcJN4YcisYoCkTbJpxcNUD5QkvCIvNNbtgwki9GbyQuDz8InFkyhNr6MDzSxgVo0pCg2Nm/RkwyaTNEwv2RY7ovg1b+8pXpvXEFKOf8wPzM6VrIKpB4ooVvdQf+Her9ccqqSDe0WF3ot9JQ7usgQtRYCJV6EbkkCIHb9pILoZGmbLyPG9LCcLgwGhUzFFwhIt3A4KOZYPEsmb9YOrOVB+kFngNTjD6+lwQkum/xP0HJp6fEEraq+vJzESHUrlgWga99XPvkpLiCOtVaibbi3F0xL9enjYRHfF0xvS7HwmaeF+GHHlF8mKZcq63HvH1d8gnuwKU7Xzw3J8pETFVGYV+WrvDE3nLIFxoMKuiptJi3oBsNOvJ3IdBm9t4CTBUVHqiQbIWrRF/DthuMdPxh8vNq43doON/An15n7ZUp6vcNqXk1XzEzX8jqu5Un83xzi6j31JeCbcRV/yfuO3P7E4qyeepYb3TCz0eIsmbW/UEJUGe+DXPgnYtG94FcNnGaFNV6rEgNP2cZD3MgiJ0R8FEtXmrKEp2+U=
    - secure: mnITwXXWBle7IOxCaaI8fQRXTLZJ1en5f5GsOYGyJKqxbbgGPnDTBqATv+KRhKCDDffN8cNeJUBVXRQP0iHDdJ1aFNGBAZWwGCxq5eIPS22K8WpZehicoT7Taf8wQrS9DL+e9nFmsfBQuoQwVdIM0c+gP9rpuyfesrzKCeXWw9WLT8aGyCXZo7a5ThmU93mQuhPgydmPGsIz1qTLBE2UAL8hb9fBfjeGvnxMIggZqUnpBa3cCLp53y196p9YwENDdisWXUiFy9jEMUjsFn3axBJzwtv4xG+cYB6htaq9c/YuJgaMQsn0Ojccm4Mu7A9X6XsEdpmma92eCyyfgKll2BqtJaicEG3L7gOcJGAkKhOueW/qUMIBohAdvCDSaPKGUUEnXpRq0nlKi4od9qGT2ZE1mT+NrNrz1ZScK5J/iMyqzeAH1yZn+55+7WCSII8hIoN0KNcpd3QYEXZwuIZvgKh1lU7H9RF5bQDOLc5k02chlsLn6Q1aZ/5PrSV9EvsYVPQT1kY6x4vjSVkAXB6D7GzLONWgv2hPsY3rVxgajx4pJRF0ax8g8TeOdRkEspcYL+GlQ+FdmBKfltx0D4D8wvc6gQ/GYm1igGf0P6Of+HqgxvPMfzi1gS7QcqfSBZUCP+uSVXQDNeTDJJb0w3JanXUFB4oP3/c/g+S04p8oj4A=
    - secure: DpjP0XcIrRBLtDPnRltlq7DD/571KE5uATE4A3GoEFgfMK6dj4OVGqfxXPzXHCVPtGBRurMMfHpo+Z45kR8eHJSGYvGJnvSdZ5thF+kQ0H5F4NLca2mye27TN7rZeOeSlmTOASqzoZCC7xDEs1y/lr35I82CebOakivlsmeBCZf0mrE3FNl/oK+W4tYhaNZE0+77XyKpPaq6967bHiQFUasmvfEXL0gB08f33oMVZa+r6S24YAk0LJyJgGdXiCtIXdqQ+8Zm1nyYf85uH3+hFnwonzXP24yTrq1e5rACj0R+2iJTtdPEtf/h5/OHI/R6NbRUMFRKo42z4wvUdCZaPQ4p8Nregf1euGk+ODkHe7+MX5KNqCFN+UlNYMXBxQYj/wfG52wljqzyxKpisjZ+79WrEpcTwRkvOfUAtySvpi3JaHAHJnetQ7tQXjioI3aVzJ//2Uyjh1zmFgydJis1ZxbgS5O+UgvPLBU5VReWpZZ8cbXji9sRrfOrIQCsUJvY4lYUKk//kYMcdxeTVvWmZJ1MnCk4Mtq9MG2H8IA0UXg80i1C2tXqEElKhGO48XytkdkCWT+CCMcylwjEEbrahIk0nZQf11cLLcYDs1olkh9nD4Ddm6kvVHNQG3BzLJKQL1Vd5GoJKw4hZzPL05/qN/1ToiQy3oD9UcFqx90rGTA=

before_install:
  - openssl aes-256-cbc -K $encrypted_bd46b89c8fce_key -iv $encrypted_bd46b89c8fce_iv -in jophiel-dist/deploy_rsa.enc -out /tmp/deploy_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/deploy_rsa
  - ssh-add /tmp/deploy_rsa
  - sudo apt-add-repository ppa:ansible/ansible -y
  - sudo apt-get -qq update
  - sudo apt-get install -y ansible docker.io python-pip
  - sudo pip install docker-py

script:
  - "./gradlew clean distTar"
  - mkdir -p jophiel-dist/dockerfiles/jophiel/build/distributions
  - tar -xf jophiel-dist/build/distributions/jophiel-* -C jophiel-dist/dockerfiles/jophiel/build/distributions

deploy:
  skip_cleanup: true
  provider: script
  script: scripts/deploy.sh
  on:
    branch: test
